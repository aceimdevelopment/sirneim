(function(a){elFinder=function(b,c){function f(a,b){a&&d.view.win.width(a),b&&d.view.nav.add(d.view.cwd).height(b)}function g(){f(null,d.dialog.height()-d.view.tlb.parent().height()-(a.browser.msie?47:32))}var d=this,e;this.log=function(a){window.console&&window.console.log&&window.console.log(a)},this.options=a.extend({},this.options,c||{});if(!this.options.url){alert("Invalid configuration! You have to set URL option.");return}this.id="";if(e=a(b).attr("id"))this.id=e;this.version="1.2",this.jquery=a.fn.jquery.split(".").join(""),this.cwd={},this.cdc={},this.buffer={},this.selected=[],this.history=[],this.locked=!1,this.zIndex=2,this.dialog=null,this.anchor=this.options.docked?a("<div/>").hide().insertBefore(b):null,this.params={dotFiles:!1,arc:"",uplMaxSize:""},this.vCookie="el-finder-view-"+this.id,this.pCookie="el-finder-places-"+this.id,this.lCookie="el-finder-last-"+this.id,this.view=new this.view(this,b),this.ui=new this.ui(this),this.eventsManager=new this.eventsManager(this),this.quickLook=new this.quickLook(this),this.cookie=function(b,c){if(typeof c=="undefined"){if(document.cookie&&document.cookie!=""){var d,e=document.cookie.split(";");b+="=";for(d=0;d<e.length;d++){e[d]=a.trim(e[d]);if(e[d].substring(0,b.length)==b)return decodeURIComponent(e[d].substring(b.length))}}return""}var f,g=a.extend({},this.options.cookie);c===null&&(c="",g.expires=-1),typeof g.expires=="number"&&(f=new Date,f.setTime(f.getTime()+g.expires*24*60*60*1e3),g.expires=f),document.cookie=b+"="+encodeURIComponent(c)+"; expires="+g.expires.toUTCString()+(g.path?"; path="+g.path:"")+(g.domain?"; domain="+g.domain:"")+(g.secure?"; secure":"")},this.lock=function(a){this.view.spinner(this.locked=a||!1),this.eventsManager.lock=this.locked},this.lockShortcuts=function(a){this.eventsManager.lock=!!a},this.setView=function(a){if(a=="list"||a=="icons")this.options.view=a,this.cookie(this.vCookie,a)},this.ajax=function(b,c,e){var f={url:this.options.url,async:!0,type:"GET",data:b,dataType:"json",cache:!1,lock:!0,force:!1,silent:!1};typeof e=="object"&&(f=a.extend({},f,e)),f.silent||(f.error=d.view.fatal),f.success=function(a){f.lock&&d.lock();if(a){a.debug&&d.log(a.debug);if(a.error){!f.silent&&d.view.error(a.error,a.errorData);if(!f.force)return}c(a),delete a}},f.lock&&this.lock(!0),a.ajax(f)},this.tmb=function(){this.ajax({cmd:"tmb",current:d.cwd.hash},function(b){if(d.options.view=="icons"&&b.images&&b.current==d.cwd.hash){for(var c in b.images)d.cdc[c]&&(d.cdc[c].tmb=b.images[c],a('div[key="'+c+'"]>p',d.view.cwd).css("background",' url("'+b.images[c]+'") 0 0 no-repeat'));b.tmb&&d.tmb()}},{lock:!1,silent:!0})},this.getPlaces=function(){var a=[],b=this.cookie(this.pCookie);return b.length&&(b.indexOf(":")!=-1?a=b.split(":"):a.push(b)),a},this.addPlace=function(b){var c=this.getPlaces();if(a.inArray(b,c)==-1)return c.push(b),this.savePlaces(c),!0},this.removePlace=function(b){var c=this.getPlaces();if(a.inArray(b,c)!=-1)return this.savePlaces(a.map(c,function(a){return a==b?null:a})),!0},this.savePlaces=function(a){this.cookie(this.pCookie,a.join(":"))},this.reload=function(a){var b;this.cwd=a.cwd,this.cdc={};for(b=0;b<a.cdc.length;b++)a.cdc[b].hash&&a.cdc[b].name&&(this.cdc[a.cdc[b].hash]=a.cdc[b],this.cwd.size+=a.cdc[b].size);a.tree&&(this.view.renderNav(a.tree),this.eventsManager.updateNav()),this.updateCwd(),a.tmb&&!d.locked&&d.options.view=="icons"&&d.tmb();if(a.select&&a.select.length){var c=a.select.length;while(c--)this.cdc[a.select[c]]&&this.selectById(a.select[c])}this.lastDir(this.cwd.hash),this.options.autoReload>0&&(this.iID&&clearInterval(this.iID),this.iID=setInterval(function(){!d.locked&&d.ui.exec("reload")},this.options.autoReload*6e4))},this.updateCwd=function(){this.lockShortcuts(!0),this.selected=[],this.view.renderCwd(),this.eventsManager.updateCwd(),this.view.tree.find('a[key="'+this.cwd.hash+'"]').trigger("select"),this.lockShortcuts()},this.drop=function(b,c,e){if(c.helper.find('[key="'+e+'"]').length)return d.view.error("Unable to copy into itself");var f=[];c.helper.find('div:not(.noaccess):has(>label):not(:has(em[class="readonly"],em[class=""]))').each(function(){f.push(a(this).hide().attr("key"))}),c.helper.find("div:has(>label):visible").length||c.helper.hide(),f.length?(d.setBuffer(f,b.shiftKey?0:1,e),d.buffer.files&&setTimeout(function(){d.ui.exec("paste"),d.buffer={}},300)):a(this).removeClass("el-finder-droppable")},this.getSelected=function(a){var b,c=[];if(a>=0)return this.cdc[this.selected[a]]||{};for(b=0;b<this.selected.length;b++)this.cdc[this.selected[b]]&&c.push(this.cdc[this.selected[b]]);return c},this.select=function(b,c){c&&a(".ui-selected",d.view.cwd).removeClass("ui-selected"),b.addClass("ui-selected"),d.updateSelect()},this.selectById=function(b){var c=a('[key="'+b+'"]',this.view.cwd);c.length&&(this.select(c),this.checkSelectedPos())},this.unselect=function(a){a.removeClass("ui-selected"),d.updateSelect()},this.toggleSelect=function(a){a.toggleClass("ui-selected"),this.updateSelect()},this.selectAll=function(){a("[key]",d.view.cwd).addClass("ui-selected"),d.updateSelect()},this.unselectAll=function(){a(".ui-selected",d.view.cwd).removeClass("ui-selected"),d.updateSelect()},this.updateSelect=function(){d.selected=[],a(".ui-selected",d.view.cwd).each(function(){d.selected.push(a(this).attr("key"))}),d.view.selectedInfo(),d.ui.update(),d.quickLook.update()},this.checkSelectedPos=function(a){var b=d.view.cwd.find(".ui-selected:"+(a?"last":"first")).eq(0),c=b.position(),e=b.outerHeight(),f=d.view.cwd.height();c.top<0?d.view.cwd.scrollTop(c.top+d.view.cwd.scrollTop()-2):f-c.top<e&&d.view.cwd.scrollTop(c.top+e-f+d.view.cwd.scrollTop())},this.setBuffer=function(a,b,c){var d,e,f;this.buffer={src:this.cwd.hash,dst:c,files:[],names:[],cut:b||0};for(d=0;d<a.length;d++)e=a[d],f=this.cdc[e],f&&f.read&&f.type!="link"&&(this.buffer.files.push(f.hash),this.buffer.names.push(f.name));this.buffer.files.length||(this.buffer={})},this.isValidName=function(a){return!this.cwd.dotFiles&&a.indexOf(".")==0?!1:a.match(/^[^\\\/\<\>:]+$/)},this.fileExists=function(a){for(var b in this.cdc)if(this.cdc[b].name==a)return b;return!1},this.uniqueName=function(a,b){a=d.i18n(a);var c=a,e=0,b=b||"";if(!this.fileExists(c+b))return c+b;while(e++<100)if(!this.fileExists(c+e+b))return c+e+b;return c.replace("100","")+Math.random()+b},this.lastDir=function(a){if(this.options.rememberLastDir)return a?this.cookie(this.lCookie,a):this.cookie(this.lCookie)},this.time=function(){return(new Date).getMilliseconds()},this.setView(this.cookie(this.vCookie)),f(d.options.width,d.options.height);if(this.options.dialog||this.options.docked)this.options.dialog=a.extend({width:570,dialogClass:"",minWidth:480,minHeight:330},this.options.dialog||{}),this.options.dialog.open=function(){setTimeout(function(){a('<input type="text" value="f"/>').appendTo(d.view.win).focus().select().remove()},200)},this.options.dialog.dialogClass+="el-finder-dialog",this.options.dialog.resize=g,this.options.docked?(this.options.dialog.close=function(){d.dock()},this.view.win.data("size",{width:this.view.win.width(),height:this.view.nav.height()})):(this.options.dialog.close=function(){d.destroy()},this.dialog=a("<div/>").append(this.view.win).dialog(this.options.dialog));this.ajax({cmd:"open",target:this.lastDir()||"",init:!0,tree:!0},function(b){b.cwd&&(d.eventsManager.init(),d.reload(b),a.extend(d.params,b.params||{}),a("*",document.body).each(function(){var b=parseInt(a(this).css("z-index"));b>=d.zIndex&&(d.zIndex=b+1)}),d.ui.init(b.disabled))},{force:!0}),this.open=function(){this.dialog?this.dialog.dialog("open"):this.view.win.show(),this.eventsManager.lock=!1},this.close=function(){this.quickLook.hide(),this.options.docked&&this.view.win.attr("undocked")?this.dock():this.dialog?this.dialog.dialog("close"):this.view.win.hide(),this.eventsManager.lock=!0},this.destroy=function(){this.eventsManager.lock=!0,this.quickLook.hide(),this.quickLook.win.remove(),this.dialog?(this.dialog.dialog("destroy"),this.view.win.parent().remove()):this.view.win.remove(),this.ui.menu.remove()},this.dock=function(){if(this.options.docked&&this.view.win.attr("undocked")){this.quickLook.hide();var a=this.view.win.data("size");this.view.win.insertAfter(this.anchor).removeAttr("undocked"),f(a.width,a.height),this.dialog.dialog("destroy"),this.dialog=null}},this.undock=function(){this.options.docked&&!this.view.win.attr("undocked")&&(this.quickLook.hide(),this.dialog=a("<div/>").append(this.view.win.css("width","100%").attr("undocked",!0).show()).dialog(this.options.dialog),g())}},elFinder.prototype.i18n=function(a){return this.options.i18n[this.options.lang]&&this.options.i18n[this.options.lang][a]?this.options.i18n[this.options.lang][a]:a},elFinder.prototype.options={url:"",lang:"en",cssClass:"",wrap:14,places:"Places",placesFirst:!0,editorCallback:null,cutURL:"",closeOnEditorCallback:!0,i18n:{},view:"icons",width:"",height:"",disableShortcuts:!1,rememberLastDir:!0,cookie:{expires:30,domain:"",path:"/",secure:!1},toolbar:[["back","reload"],["select","open"],["mkdir","mkfile","upload"],["copy","paste","rm"],["rename","edit"],["info","quicklook","resize"],["icons","list"],["help"]],contextmenu:{cwd:["reload","delim","mkdir","mkfile","upload","delim","paste","delim","info"],file:["select","open","quicklook","delim","copy","cut","rm","delim","duplicate","rename","edit","resize","archive","extract","delim","info"],group:["select","copy","cut","rm","delim","archive","extract","delim","info"]},dialog:null,docked:!1,autoReload:0,selectMultiple:!1},a.fn.elfinder=function(a){return this.each(function(){var c=typeof a=="string"?a:"";this.elfinder||(this.elfinder=new elFinder(this,typeof a=="object"?a:{}));switch(c){case"close":case"hide":this.elfinder.close();break;case"open":case"show":this.elfinder.open();break;case"dock":this.elfinder.dock();break;case"undock":this.elfinder.undock();break;case"destroy":this.elfinder.destroy()}})}})(jQuery),function(a){elFinder.prototype.view=function(b,c){var d=this;this.fm=b,this.kinds={unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"Broken alias","application/x-empty":"Plain text","application/postscript":"Postscript document","application/octet-stream":"Application","application/vnd.ms-office":"Microsoft Office document","application/vnd.ms-word":"Microsoft Word document","application/vnd.ms-excel":"Microsoft Excel document","application/vnd.ms-powerpoint":"Microsoft Powerpoint presentation","application/pdf":"Portable Document Format (PDF)","application/vnd.oasis.opendocument.text":"Open Office document","application/x-shockwave-flash":"Flash application","application/xml":"XML document","application/x-bittorrent":"Bittorrent file","application/x-7z-compressed":"7z archive","application/x-tar":"TAR archive","application/x-gzip":"GZIP archive","application/x-bzip2":"BZIP archive","application/zip":"ZIP archive","application/x-rar":"RAR archive","application/javascript":"Javascript application","text/plain":"Plain text","text/x-php":"PHP source","text/html":"HTML document","text/javascript":"Javascript source","text/css":"CSS style sheet","text/rtf":"Rich Text Format (RTF)","text/rtfd":"RTF with attachments (RTFD)","text/x-c":"C source","text/x-c++":"C++ source","text/x-shellscript":"Unix shell script","text/x-python":"Python source","text/x-java":"Java source","text/x-ruby":"Ruby source","text/x-perl":"Perl script","text/xml":"XML document","image/x-ms-bmp":"BMP image","image/jpeg":"JPEG image","image/gif":"GIF Image","image/png":"PNG image","image/x-targa":"TGA image","image/tiff":"TIFF image","image/vnd.adobe.photoshop":"Adobe Photoshop image","audio/mpeg":"MPEG audio","audio/midi":"MIDI audio","audio/ogg":"Ogg Vorbis audio","audio/mp4":"MP4 audio","audio/wav":"WAV audio","video/x-dv":"DV video","video/mp4":"MP4 video","video/mpeg":"MPEG video","video/x-msvideo":"AVI video","video/quicktime":"Quicktime video","video/x-ms-wmv":"WM video","video/x-flv":"Flash video","video/x-matroska":"Matroska video"},this.tlb=a("<ul />"),this.nav=a('<div class="el-finder-nav"/>').resizable({handles:"e",autoHide:!0,minWidth:200,maxWidth:500}),this.cwd=a('<div class="el-finder-cwd"/>').attr("unselectable","on"),this.spn=a('<div class="el-finder-spinner"/>'),this.err=a('<p class="el-finder-err"><strong/></p>').click(function(){a(this).hide()}),this.nfo=a('<div class="el-finder-stat"/>'),this.pth=a('<div class="el-finder-path"/>'),this.sel=a('<div class="el-finder-sel"/>'),this.stb=a('<div class="el-finder-statusbar"/>').append(this.pth).append(this.nfo).append(this.sel),this.wrz=a('<div class="el-finder-workzone" />').append(this.nav).append(this.cwd).append(this.spn).append(this.err).append('<div style="clear:both" />'),this.win=a(c).empty().attr("id",this.fm.id).addClass("el-finder "+(b.options.cssClass||"")).append(a('<div class="el-finder-toolbar" />').append(this.tlb)).append(this.wrz).append(this.stb),this.tree=a('<ul class="el-finder-tree"></ul>').appendTo(this.nav),this.plc=a('<ul class="el-finder-places"><li><a href="#" class="el-finder-places-root"><div/>'+this.fm.i18n(this.fm.options.places)+"</a><ul/></li></ul>").hide(),this.nav[this.fm.options.placesFirst?"prepend":"append"](this.plc),this.spinner=function(a){this.win.toggleClass("el-finder-disabled",a),this.spn.toggle(a)},this.fatal=function(a){d.error(a.status!="404"?"Invalid backend configuration":"Unable to connect to backend")},this.error=function(a,b){this.fm.lock(),this.err.show().children("strong").html(this.fm.i18n(a)+"!"+this.formatErrorData(b)),setTimeout(function(){d.err.fadeOut("slow")},4e3)},this.renderNav=function(a){function d(a){var b,c,e,f='<ul style="display:none">';for(b=0;b<a.length;b++){if(!a[b].name||!a[b].hash)continue;e="",!a[b].read&&!a[b].write?e="noaccess":a[b].read?a[b].write||(e="readonly"):e="dropbox",f+='<li><a href="#" class="'+e+'" key="'+a[b].hash+'"><div'+(a[b].dirs.length?' class="collapsed"':"")+"/>"+a[b].name+"</a>",a[b].dirs.length&&(f+=d(a[b].dirs)),f+="</li>"}return f+"</ul>"}var b=a.dirs.length?d(a.dirs):"",c='<li><a href="#" class="el-finder-tree-root" key="'+a.hash+'"><div'+(b?' class="collapsed expanded"':"")+"/>"+a.name+"</a>"+b+"</li>";this.tree.html(c),this.fm.options.places&&this.renderPlaces()},this.renderPlaces=function(){var b,c,e=this.fm.getPlaces(),f=this.plc.show().find("ul").empty().hide();a("div:first",this.plc).removeClass("collapsed expanded");if(e.length){e.sort(function(a,b){var c=d.tree.find('a[key="'+a+'"]').text()||"",e=d.tree.find('a[key="'+b+'"]').text()||"";return c.localeCompare(e)});for(b=0;b<e.length;b++)(c=this.tree.find('a[key="'+e[b]+'"]:not(.dropbox)').parent())&&c.length?f.append(c.clone().children("ul").remove().end().find("div").removeClass("collapsed expanded").end()):this.fm.removePlace(e[b]);f.children().length&&a("div:first",this.plc).addClass("collapsed")}},this.renderCwd=function(){this.cwd.empty();var a=0,c=0,d="";for(var e in this.fm.cdc)a++,c+=this.fm.cdc[e].size,d+=this.fm.options.view=="icons"?this.renderIcon(this.fm.cdc[e]):this.renderRow(this.fm.cdc[e],a%2);this.fm.options.view=="icons"?this.cwd.append(d):this.cwd.append('<table><tr><th colspan="2">'+this.fm.i18n("Name")+"</th><th>"+this.fm.i18n("Permissions")+"</th><th>"+this.fm.i18n("Modified")+'</th><th class="size">'+this.fm.i18n("Size")+"</th><th>"+this.fm.i18n("Kind")+"</th></tr>"+d+"</table>"),this.pth.text(b.cwd.rel),this.nfo.text(b.i18n("items")+": "+a+", "+this.formatSize(c)),this.sel.empty()},this.renderIcon=function(a){var b="<p"+(a.tmb?" style=\"background:url('"+a.tmb+"') 0 0 no-repeat\"":"")+"/><label>"+this.formatName(a.name)+"</label>";if(a.link||a.mime=="symlink-broken")b+="<em/>";return!a.read&&!a.write?b+='<em class="noaccess"/>':a.read&&!a.write?b+='<em class="readonly"/>':!a.read&&a.write&&(b+='<em class="'+(a.mime=="directory"?"dropbox":"noread")+'" />'),'<div class="'+this.mime2class(a.mime)+'" key="'+a.hash+'">'+b+"</div>"},this.renderRow=function(a,b){var c=a.link||a.mime=="symlink-broken"?"<em/>":"";return!a.read&&!a.write?c+='<em class="noaccess"/>':a.read&&!a.write?c+='<em class="readonly"/>':!a.read&&a.write&&(c+='<em class="'+(a.mime=="directory"?"dropbox":"noread")+'" />'),'<tr key="'+a.hash+'" class="'+d.mime2class(a.mime)+(b?" el-finder-row-odd":"")+'"><td class="icon"><p>'+c+"</p></td><td>"+a.name+"</td><td>"+d.formatPermissions(a.read,a.write,a.rm)+"</td><td>"+d.formatDate(a.date)+'</td><td class="size">'+d.formatSize(a.size)+"</td><td>"+d.mime2kind(a.link?"symlink":a.mime)+"</td></tr>"},this.updateFile=function(a){var b=this.cwd.find('[key="'+a.hash+'"]');b.replaceWith(b[0].nodeName=="DIV"?this.renderIcon(a):this.renderRow(a))},this.selectedInfo=function(){var a,b=0,c;if(d.fm.selected.length){c=this.fm.getSelected();for(a=0;a<c.length;a++)b+=c[a].size}this.sel.text(a>0?this.fm.i18n("selected items")+": "+c.length+", "+this.formatSize(b):"")},this.formatName=function(a){var b=d.fm.options.wrap;if(b>0){if(a.length>b*2)return a.substr(0,b)+"&shy;"+a.substr(b,b-5)+"&hellip;"+a.substr(a.length-3);if(a.length>b)return a.substr(0,b)+"&shy;"+a.substr(b)}return a},this.formatErrorData=function(a){var b,c="";if(typeof a=="object"){c="<br />";for(b in a)c+=b+" "+d.fm.i18n(a[b])+"<br />"}return c},this.mime2class=function(a){return a.replace("/"," ").replace(/\./g,"-")},this.formatDate=function(a){return a.replace(/([a-z]+)\s/i,function(a,b){return d.fm.i18n(b)+" "})},this.formatSize=function(a){var b=1,c="bytes";return a>1073741824?(b=1073741824,c="Gb"):a>1048576?(b=1048576,c="Mb"):a>1024&&(b=1024,c="Kb"),Math.round(a/b)+" "+c},this.formatPermissions=function(a,b,c){var e=[];return a&&e.push(d.fm.i18n("read")),b&&e.push(d.fm.i18n("write")),c&&e.push(d.fm.i18n("remove")),e.join("/")},this.mime2kind=function(a){return this.fm.i18n(this.kinds[a]||"unknown")}}}(jQuery),function(a){elFinder.prototype.ui=function(b){var c=this;this.fm=b,this.cmd={},this.buttons={},this.menu=a('<div class="el-finder-contextmenu" />').appendTo(document.body).hide(),this.dockButton=a('<div class="el-finder-dock-button" title="'+c.fm.i18n("Dock/undock filemanager window")+'" />'),this.exec=function(b,c){if(this.cmd[b]){if(b!="open"&&!this.cmd[b].isAllowed())return this.fm.view.error("Command not allowed");this.fm.locked||(this.fm.quickLook.hide(),a(".el-finder-info").remove(),this.cmd[b].exec(c),this.update())}},this.cmdName=function(a){return this.cmd[a]&&this.cmd[a].name?a=="archive"&&this.fm.params.archives.length==1?this.fm.i18n("Create")+" "+this.fm.view.mime2kind(this.fm.params.archives[0]).toLowerCase():this.fm.i18n(this.cmd[a].name):a},this.isCmdAllowed=function(a){return c.cmd[a]&&c.cmd[a].isAllowed()},this.execIfAllowed=function(a){this.isCmdAllowed(a)&&this.exec(a)},this.includeInCm=function(a,b){return this.isCmdAllowed(a)&&this.cmd[a].cm(b)},this.showMenu=function(b){function h(a){var b,d,e,f,g,h=c.fm.options.contextmenu[a]||[];for(b=0;b<h.length;b++)if(h[b]=="delim")c.menu.children().length&&!c.menu.children(":last").hasClass("delim")&&c.menu.append('<div class="delim" />');else if(c.fm.ui.includeInCm(h[b],a)){e=c.cmd[h[b]].argc(),f="";if(e.length){f='<span/><div class="el-finder-contextmenu-sub" style="z-index:'+(parseInt(c.menu.css("z-index"))+1)+'">';for(var d=0;d<e.length;d++)f+='<div name="'+h[b]+'" argc="'+e[d].argc+'" class="'+e[d]["class"]+'">'+e[d].text+"</div>";f+="</div>"}c.menu.append('<div class="'+h[b]+'" name="'+h[b]+'">'+f+c.cmdName(h[b])+"</div>")}}var d,e,f,g="";this.hideMenu(),c.fm.selected.length?c.fm.selected.length==1?d="file":d="group":d="cwd",h(d),e=a(window),f={height:e.height(),width:e.width(),sT:e.scrollTop(),cW:this.menu.width(),cH:this.menu.height()},this.menu.css({left:b.clientX+f.cW>f.width?b.clientX-f.cW:b.clientX,top:b.clientY+f.cH>f.height&&b.clientY>f.cH?b.clientY+f.sT-f.cH:b.clientY+f.sT}).show().find("div[name]").hover(function(){var b=a(this),c=b.children("div"),d;b.addClass("hover"),c.length&&(c.attr("pos")||(d=b.outerWidth(),c.css(a(window).width()-d-b.offset().left>c.width()?"left":"right",d-5).attr("pos",!0)),c.show())},function(){a(this).removeClass("hover").children("div").hide()}).click(function(b){b.stopPropagation();var d=a(this);d.children("div").length||(c.hideMenu(),c.exec(d.attr("name"),d.attr("argc")))})},this.hideMenu=function(){this.menu.hide().empty()},this.update=function(){for(var a in this.buttons)this.buttons[a].toggleClass("disabled",!this.cmd[a].isAllowed())},this.init=function(b){var d,e,f,g=!1,h=2,i,j=this.fm.options.toolbar;this.fm.options.editorCallback||b.push("select"),!this.fm.params.archives.length&&a.inArray("archive",b)==-1&&b.push("archive");for(d in this.commands)a.inArray(d,b)==-1&&(this.commands[d].prototype=this.command.prototype,this.cmd[d]=new this.commands[d](this.fm));for(d=0;d<j.length;d++){g&&this.fm.view.tlb.append('<li class="delim" />'),g=!1;for(e=0;e<j[d].length;e++)f=j[d][e],this.cmd[f]&&(g=!0,this.buttons[f]=a('<li class="'+f+'" title="'+this.cmdName(f)+'" name="'+f+'" />').appendTo(this.fm.view.tlb).click(function(a){a.stopPropagation()}).bind("click",function(b){return function(){!a(this).hasClass("disabled")&&b.exec(a(this).attr("name"))}}(this)).hover(function(){!a(this).hasClass("disabled")&&a(this).addClass("el-finder-tb-hover")},function(){a(this).removeClass("el-finder-tb-hover")}))}this.update(),this.menu.css("z-index",this.fm.zIndex),this.fm.options.docked&&this.dockButton.hover(function(){a(this).addClass("el-finder-dock-button-hover")},function(){a(this).removeClass("el-finder-dock-button-hover")}).click(function(){c.fm.view.win.attr("undocked")?c.fm.dock():c.fm.undock(),a(this).trigger("mouseout")}).prependTo(this.fm.view.tlb)}},elFinder.prototype.ui.prototype.command=function(a){},elFinder.prototype.ui.prototype.command.prototype.isAllowed=function(){return!0},elFinder.prototype.ui.prototype.command.prototype.cm=function(a){return!1},elFinder.prototype.ui.prototype.command.prototype.argc=function(a){return[]},elFinder.prototype.ui.prototype.commands={back:function(a){var b=this;this.name="Back",this.fm=a,this.exec=function(){this.fm.history.length&&this.fm.ajax({cmd:"open",target:this.fm.history.pop()},function(a){b.fm.reload(a)})},this.isAllowed=function(){return this.fm.history.length}},reload:function(a){var b=this;this.name="Reload",this.fm=a,this.exec=function(){this.fm.ajax({cmd:"open",target:this.fm.cwd.hash,tree:!0},function(a){b.fm.reload(a)})},this.cm=function(a){return a=="cwd"}},open:function(b){var c=this;this.name="Open",this.fm=b,this.exec=function(b){function e(a){c.fm.history.push(c.fm.cwd.hash),c.fm.ajax({cmd:"open",target:a},function(a){c.fm.reload(a)})}function f(a){var b,d="";a.dim&&(b=a.dim.split("x"),d="width="+(parseInt(b[0])+20)+",height="+(parseInt(b[1])+20)+","),window.open(a.url||c.fm.options.url+"?cmd=open&current="+(a.parent||c.fm.cwd.hash)+"&target="+(a.link||a.hash),!1,"top=50,left=50,"+d+"scrollbars=yes,resizable=yes")}var d=null;b?d={hash:a(b).attr("key"),mime:"directory",read:!a(b).hasClass("noaccess")&&!a(b).hasClass("dropbox")}:d=this.fm.getSelected(0);if(!d.hash)return;if(!d.read)return this.fm.view.error("Access denied");if(d.type=="link"&&!d.link)return this.fm.view.error("Unable to open broken link");d.mime=="directory"?e(d.link||d.hash):f(d)},this.isAllowed=function(){return this.fm.selected.length==1&&this.fm.getSelected(0).read},this.cm=function(a){return a=="file"}},select:function(b){this.name="Select file",this.fm=b,b.options.selectMultiple?this.exec=function(){var c=a(b.getSelected()).map(function(){return b.options.cutURL=="root"?this.url.substr(b.params.url.length):this.url.replace(new RegExp("^("+b.options.cutURL+")"),"")});b.options.editorCallback(c),b.options.closeOnEditorCallback&&(b.dock(),b.close())}:this.exec=function(){var a=this.fm.getSelected(0);if(!a.url)return this.fm.view.error("File URL disabled by connector config");this.fm.options.editorCallback(this.fm.options.cutURL=="root"?a.url.substr(this.fm.params.url.length):a.url.replace(new RegExp("^("+this.fm.options.cutURL+")"),"")),this.fm.options.closeOnEditorCallback&&(this.fm.dock(),this.fm.close(),this.fm.destroy())},this.isAllowed=function(){return(this.fm.options.selectMultiple&&this.fm.selected.length>=1||this.fm.selected.length==1)&&!/(symlink\-broken|directory)/.test(this.fm.getSelected(0).mime)},this.cm=function(a){return a!="cwd"}},quicklook:function(a){var b=this;this.name="Preview with Quick Look",this.fm=a,this.exec=function(){b.fm.quickLook.toggle()},this.isAllowed=function(){return this.fm.selected.length==1},this.cm=function(){return!0}},info:function(b){var c=this;this.name="Get info",this.fm=b,this.exec=function(){function h(b){var d=["50%","50%"],h,i,j,k='<table cellspacing="0"><tr><td>'+c.fm.i18n("Name")+"</td><td>"+b.name+"</td></tr><tr><td>"+c.fm.i18n("Kind")+"</td><td>"+c.fm.view.mime2kind(b.link?"symlink":b.mime)+"</td></tr><tr><td>"+c.fm.i18n("Size")+"</td><td>"+c.fm.view.formatSize(b.size)+"</td></tr><tr><td>"+c.fm.i18n("Modified")+"</td><td>"+c.fm.view.formatDate(b.date)+"</td></tr><tr><td>"+c.fm.i18n("Permissions")+"</td><td>"+c.fm.view.formatPermissions(b.read,b.write,b.rm)+"</td></tr>";b.link&&(k+="<tr><td>"+c.fm.i18n("Link to")+"</td><td>"+b.linkTo+"</td></tr>"),b.dim&&(k+="<tr><td>"+c.fm.i18n("Dimensions")+"</td><td>"+b.dim+" px.</td></tr>"),b.url&&(k+="<tr><td>"+c.fm.i18n("URL")+'</td><td><a href="'+b.url+'" target="_blank">'+b.url+"</a></td></tr>"),e>1&&(j=a(".el-finder-dialog-info:last"),j.length?(h=j.offset().left+10,i=j.offset().top+10,d=[h<f-350?h:20,i<g-300?i:20]):(h=Math.round((f-350)/2-e*10),i=Math.round((g-300)/2-e*10),d=[h>20?h:20,i>20?i:20])),a("<div />").append(k+"</table>").dialog({dialogClass:"el-finder-dialog el-finder-dialog-info",width:390,position:d,title:c.fm.i18n(b.mime=="directory"?"Folder info":"File info"),close:function(){--e<=0&&c.fm.lockShortcuts(),a(this).dialog("destroy")},buttons:{Ok:function(){a(this).dialog("close")}}})}var b,d,e=this.fm.selected.length,f=a(window).width(),g=a(window).height();this.fm.lockShortcuts(!0),e?a.each(this.fm.getSelected(),function(){h(this)}):h(c.fm.cwd)},this.cm=function(a){return!0}},rename:function(b){var c=this;this.name="Rename",this.fm=b,this.exec=function(){function i(){e.html(h),c.fm.lockShortcuts()}function j(){if(!c.fm.locked){var a,b=f.val();if(g.name==f.val())return i();c.fm.isValidName(b)?c.fm.fileExists(b)&&(a="File or folder with the same name already exists"):a="Invalid name";if(a)return c.fm.view.error(a),d.addClass("ui-selected"),c.fm.lockShortcuts(!0),f.select().focus();c.fm.ajax({cmd:"rename",current:c.fm.cwd.hash,target:g.hash,name:b},function(a){a.error?i():(g.mime=="directory"&&c.fm.removePlace(g.hash)&&c.fm.addPlace(a.target),c.fm.reload(a))},{force:!0})}}var b=this.fm.getSelected(),d,e,f,g,h;b.length==1&&(g=b[0],d=this.fm.view.cwd.find('[key="'+g.hash+'"]'),e=this.fm.options.view=="icons"?d.children("label"):d.find("td").eq(1),h=e.html(),f=a('<input type="text" />').val(g.name).appendTo(e.empty()).bind("change blur",j).keydown(function(b){b.stopPropagation(),b.keyCode==27?i():b.keyCode==13&&(g.name==f.val()?i():a(this).trigger("change"))}).click(function(a){a.stopPropagation()}).select().focus(),this.fm.lockShortcuts(!0))},this.isAllowed=function(){return this.fm.cwd.write&&this.fm.getSelected(0).write},this.cm=function(a){return a=="file"}},copy:function(a){this.name="Copy",this.fm=a,this.exec=function(){this.fm.setBuffer(this.fm.selected)},this.isAllowed=function(){if(this.fm.selected.length){var a=this.fm.getSelected(),b=a.length;while(b--)if(a[b].read)return!0}return!1},this.cm=function(a){return a!="cwd"}},cut:function(a){this.name="Cut",this.fm=a,this.exec=function(){this.fm.setBuffer(this.fm.selected,1)},this.isAllowed=function(){if(this.fm.selected.length){var a=this.fm.getSelected(),b=a.length;while(b--)if(a[b].read&&a[b].rm)return!0}return!1},this.cm=function(a){return a!="cwd"}},paste:function(a){var b=this;this.name="Paste",this.fm=a,this.exec=function(){var a,c,d,e,f="";this.fm.buffer.dst||(this.fm.buffer.dst=this.fm.cwd.hash),c=this.fm.view.tree.find('[key="'+this.fm.buffer.dst+'"]');if(!c.length||c.hasClass("noaccess")||c.hasClass("readonly"))return this.fm.view.error("Access denied");if(this.fm.buffer.src==this.fm.buffer.dst)return this.fm.view.error("Unable to copy into itself");var g={cmd:"paste",current:this.fm.cwd.hash,src:this.fm.buffer.src,dst:this.fm.buffer.dst,cut:this.fm.buffer.cut};this.fm.jquery>132?g.targets=this.fm.buffer.files:g["targets[]"]=this.fm.buffer.files,this.fm.ajax(g,function(a){a.cdc&&b.fm.reload(a)},{force:!0})},this.isAllowed=function(){return this.fm.buffer.files},this.cm=function(a){return a=="cwd"}},rm:function(b){var c=this;this.name="Remove",this.fm=b,this.exec=function(){var b,d=[],e=this.fm.getSelected();for(var b=0;b<e.length;b++){if(!e[b].rm)return this.fm.view.error(e[b].name+": "+this.fm.i18n("Access denied"));d.push(e[b].hash)}d.length&&(this.fm.lockShortcuts(!0),a('<div><div class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert"/><strong>'+this.fm.i18n("Are you sure you want to remove files?<br /> This cannot be undone!")+"</strong></div></div>").dialog({title:this.fm.i18n("Confirmation required"),dialogClass:"el-finder-dialog",width:350,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){a(this).dialog("close")},Ok:function(){a(this).dialog("close");var b={cmd:"rm",current:c.fm.cwd.hash};c.fm.jquery>132?b.targets=d:b["targets[]"]=d,c.fm.ajax(b,function(a){a.tree&&c.fm.reload(a)},{force:!0})}}}))},this.isAllowed=function(a){if(this.fm.selected.length){var b=this.fm.getSelected(),c=b.length;while(c--)if(b[c].rm)return!0}return!1},this.cm=function(a){return a!="cwd"}},mkdir:function(b){var c=this;this.name="New folder",this.fm=b,this.exec=function(){function d(){if(!c.fm.locked){var a,b=input.val();c.fm.isValidName(b)?c.fm.fileExists(b)&&(a="File or folder with the same name already exists"):a="Invalid name";if(a)return c.fm.view.error(a),c.fm.lockShortcuts(!0),el.addClass("ui-selected"),input.select().focus();c.fm.ajax({cmd:"mkdir",current:c.fm.cwd.hash,name:b},function(a){if(a.error)return el.addClass("ui-selected"),input.select().focus();c.fm.reload(a)},{force:!0})}}c.fm.unselectAll();var b=this.fm.uniqueName("untitled folder");input=a('<input type="text"/>').val(b),prev=this.fm.view.cwd.find(".directory:last"),f={name:b,hash:"",mime:"directory",read:!0,write:!0,date:"",size:0},el=this.fm.options.view=="list"?a(this.fm.view.renderRow(f)).children("td").eq(1).empty().append(input).end().end():a(this.fm.view.renderIcon(f)).children("label").empty().append(input).end(),el.addClass("directory ui-selected"),prev.length?el.insertAfter(prev):this.fm.options.view=="list"?el.insertAfter(this.fm.view.cwd.find("tr").eq(0)):el.prependTo(this.fm.view.cwd),c.fm.checkSelectedPos(),input.select().focus().click(function(a){a.stopPropagation()}).bind("change blur",d).keydown(function(a){a.stopPropagation(),a.keyCode==27?(el.remove(),c.fm.lockShortcuts()):a.keyCode==13&&d()}),c.fm.lockShortcuts(!0)},this.isAllowed=function(){return this.fm.cwd.write},this.cm=function(a){return a=="cwd"}},mkfile:function(b){var c=this;this.name="New text file",this.fm=b,this.exec=function(){function g(){if(!c.fm.locked){var a,b=d.val();c.fm.isValidName(b)?c.fm.fileExists(b)&&(a="File or folder with the same name already exists"):a="Invalid name";if(a)return c.fm.view.error(a),c.fm.lockShortcuts(!0),f.addClass("ui-selected"),d.select().focus();c.fm.ajax({cmd:"mkfile",current:c.fm.cwd.hash,name:b},function(a){if(a.error)return f.addClass("ui-selected"),d.select().focus();c.fm.reload(a)},{force:!0})}}c.fm.unselectAll();var b=this.fm.uniqueName("untitled file",".txt"),d=a('<input type="text"/>').val(b),e={name:b,hash:"",mime:"text/plain",read:!0,write:!0,date:"",size:0},f=this.fm.options.view=="list"?a(this.fm.view.renderRow(e)).children("td").eq(1).empty().append(d).end().end():a(this.fm.view.renderIcon(e)).children("label").empty().append(d).end();f.addClass("text ui-selected").appendTo(this.fm.options.view=="list"?c.fm.view.cwd.children("table"):c.fm.view.cwd),d.select().focus().bind("change blur",g).click(function(a){a.stopPropagation()}).keydown(function(a){a.stopPropagation(),a.keyCode==27?(f.remove(),c.fm.lockShortcuts()):a.keyCode==13&&g()}),c.fm.lockShortcuts(!0)},this.isAllowed=function(a){return this.fm.cwd.write},this.cm=function(a){return a=="cwd"}},upload:function(b){var c=this;this.name="Upload files",this.fm=b,this.exec=function(){function l(a){d.show().find("div").empty().text(a)}function m(){function k(){try{h=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;if(h.body==null||h.body.innerHTML=="")return--f?setTimeout(k,100):(l(),c.fm.view.error("Unable to access iframe DOM after 50 tries"));i=a(h.body).html(),c.fm.jquery>=141?j=a.
parseJSON(i):/^[\],:{}\s]*$/.test(i.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?j=window.JSON&&window.JSON.parse?window.JSON.parse(i):(new Function("return "+i))():j={error:"Unable to parse server response"}}catch(b){j={error:"Unable to parse server response"}}l(),j.error&&c.fm.view.error(j.error,j.errorData),j.cwd&&c.fm.reload(j),j.tmb&&c.fm.tmb()}function l(){c.fm.lock(),d.remove()}var d=a('<iframe name="'+b+'" name="'+b+'" src="about:blank"/>'),e=d[0],f=50,h,i,j;d.css({position:"absolute",top:"-1000px",left:"-1000px"}).appendTo("body").bind("load",function(){d.unbind("load"),k()}),c.fm.lock(!0),g.submit()}var b="el-finder-io-"+(new Date).getTime(),d=a('<div class="ui-state-error ui-corner-all"><span class="ui-icon ui-icon-alert"/><div/></div>'),e=this.fm.params.uplMaxSize?"<p>"+this.fm.i18n("Maximum allowed files size")+": "+this.fm.params.uplMaxSize+"</p>":"",f=a('<p class="el-finder-add-field"><span class="ui-state-default ui-corner-all"><em class="ui-icon ui-icon-circle-plus"/></span>'+this.fm.i18n("Add field")+"</p>").click(function(){a(this).before('<p><input type="file" name="upload[]"/></p>')}),g='<form method="post" enctype="multipart/form-data" action="'+c.fm.options.url+'" target="'+b+'"><input type="hidden" name="cmd" value="upload" /><input type="hidden" name="current" value="'+c.fm.cwd.hash+'" />',h=a("<div/>"),i=3;while(i--)g+='<p><input type="file" name="upload[]"/></p>';var j=a("meta[name=csrf-token]").attr("content"),k=a("meta[name=csrf-param]").attr("content");k!=null&&j!=null&&(g+='<input name="'+k+'" value="'+j+'" type="hidden" />'),g=a(g+"</form>"),h.append(g.append(d.hide()).prepend(e).append(f)).dialog({dialogClass:"el-finder-dialog",title:c.fm.i18n("Upload files"),modal:!0,resizable:!1,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){a(this).dialog("close")},Ok:function(){if(!a(":file[value]",g).length)return l(c.fm.i18n("Select at least one file to upload"));setTimeout(function(){c.fm.lock(),a.browser.safari?a.ajax({url:c.fm.options.url,data:{cmd:"ping"},error:m,success:m}):m()}),a(this).dialog("close")}}}),c.fm.lockShortcuts(!0)},this.isAllowed=function(){return this.fm.cwd.write},this.cm=function(a){return a=="cwd"}},duplicate:function(a){var b=this;this.name="Duplicate",this.fm=a,this.exec=function(){this.fm.ajax({cmd:"duplicate",current:this.fm.cwd.hash,target:this.fm.selected[0]},function(a){b.fm.reload(a)})},this.isAllowed=function(){return this.fm.cwd.write&&this.fm.selected.length==1&&this.fm.getSelected()[0].read},this.cm=function(a){return a=="file"}},edit:function(b){var c=this;this.name="Edit text file",this.fm=b,this.exec=function(){var b=this.fm.getSelected(0);this.fm.lockShortcuts(!0),this.fm.ajax({cmd:"read",current:this.fm.cwd.hash,target:b.hash},function(e){c.fm.lockShortcuts(!0);var f=a("<textarea/>").val(e.content||"").keydown(function(b){b.stopPropagation();if(b.keyCode==9){b.preventDefault();if(a.browser.msie){var c=document.selection.createRange();c.text="\t"+c.text,this.focus()}else{var d=this.value.substr(0,this.selectionStart),e=this.value.substr(this.selectionEnd);this.value=d+"\t"+e,this.setSelectionRange(d.length+1,d.length+1)}}});a("<div/>").append(f).dialog({dialogClass:"el-finder-dialog",title:c.fm.i18n(c.name),modal:!0,width:500,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){a(this).dialog("close")},Ok:function(){var e=f.val();a(this).dialog("close"),c.fm.ajax({cmd:"edit",current:c.fm.cwd.hash,target:b.hash,content:e},function(a){a.target&&(c.fm.cdc[a.target.hash]=a.target,c.fm.view.updateFile(a.target),c.fm.selectById(a.target.hash))},{type:"POST"})}}})})},this.isAllowed=function(){if(c.fm.selected.length==1){var a=this.fm.getSelected()[0];return a.write&&a.read&&(a.mime.indexOf("text")==0||a.mime=="application/x-empty"||a.mime=="application/xml")}},this.cm=function(a){return a=="file"}},archive:function(b){var c=this;this.name="Create archive",this.fm=b,this.exec=function(b){var d={cmd:"archive",current:c.fm.cwd.hash,type:a.inArray(b,this.fm.params.archives)!=-1?b:this.fm.params.archives[0],name:c.fm.i18n("Archive")};this.fm.jquery>132?d.targets=c.fm.selected:d["targets[]"]=c.fm.selected,this.fm.ajax(d,function(a){c.fm.reload(a)})},this.isAllowed=function(){if(this.fm.cwd.write&&this.fm.selected.length){var a=this.fm.getSelected(),b=a.length;while(b--)if(a[b].read)return!0}return!1},this.cm=function(a){return a!="cwd"},this.argc=function(){var a,b=[];for(a=0;a<c.fm.params.archives.length;a++)b.push({"class":"archive",argc:c.fm.params.archives[a],text:c.fm.view.mime2kind(c.fm.params.archives[a])});return b}},extract:function(b){var c=this;this.name="Uncompress archive",this.fm=b,this.exec=function(){this.fm.ajax({cmd:"extract",current:this.fm.cwd.hash,target:this.fm.getSelected(0).hash},function(a){c.fm.reload(a)})},this.isAllowed=function(){var b=this.fm.params.extract,c=b&&b.length;return this.fm.cwd.write&&this.fm.selected.length==1&&this.fm.getSelected(0).read&&c&&a.inArray(this.fm.getSelected(0).mime,b)!=-1},this.cm=function(a){return a=="file"}},resize:function(b){var c=this;this.name="Resize image",this.fm=b,this.exec=function(){function j(){var a=parseInt(iw.val())||0,b=parseInt(ih.val())||0;a<=0||b<=0?(a=e,b=g):this==iw.get(0)?b=parseInt(a/h):a=parseInt(b*h),iw.val(a),ih.val(b)}var b=this.fm.getSelected();if(b[0]&&b[0].write&&b[0].dim){var d=b[0].dim.split("x"),e=parseInt(d[0]),g=parseInt(d[1]),h=e/g;iw=a('<input type="text" size="9" value="'+e+'" name="width"/>'),ih=a('<input type="text" size="9" value="'+g+'" name="height"/>'),f=a("<form/>").append(iw).append(" x ").append(ih).append(" px"),iw.add(ih).bind("change",j),c.fm.lockShortcuts(!0);var i=a("<div/>").append(a("<div/>").text(c.fm.i18n("Dimensions")+":")).append(f).dialog({title:c.fm.i18n("Resize image"),dialogClass:"el-finder-dialog",width:230,modal:!0,close:function(){c.fm.lockShortcuts()},buttons:{Cancel:function(){a(this).dialog("close")},Ok:function(){var d=parseInt(iw.val())||0,f=parseInt(ih.val())||0;d>0&&d!=e&&f>0&&f!=g&&c.fm.ajax({cmd:"resize",current:c.fm.cwd.hash,target:b[0].hash,width:d,height:f},function(a){c.fm.reload(a)}),a(this).dialog("close")}}})}},this.isAllowed=function(){return this.fm.selected.length==1&&this.fm.cdc[this.fm.selected[0]].write&&this.fm.cdc[this.fm.selected[0]].read&&this.fm.cdc[this.fm.selected[0]].resize},this.cm=function(a){return a=="file"}},icons:function(b){this.name="View as icons",this.fm=b,this.exec=function(){this.fm.view.win.addClass("el-finder-disabled"),this.fm.setView("icons"),this.fm.updateCwd(),this.fm.view.win.removeClass("el-finder-disabled"),a("div.image",this.fm.view.cwd).length&&this.fm.tmb()},this.isAllowed=function(){return this.fm.options.view!="icons"},this.cm=function(a){return a=="cwd"}},list:function(a){this.name="View as list",this.fm=a,this.exec=function(){this.fm.view.win.addClass("el-finder-disabled"),this.fm.setView("list"),this.fm.updateCwd(),this.fm.view.win.removeClass("el-finder-disabled")},this.isAllowed=function(){return this.fm.options.view!="list"},this.cm=function(a){return a=="cwd"}},help:function(b){this.name="Help",this.fm=b,this.exec=function(){var b,c=this.fm.i18n("helpText"),d,e,f;b='<div class="el-finder-logo"/><strong>'+this.fm.i18n("elFinder: Web file manager")+"</strong><br/>"+this.fm.i18n("Version")+": "+this.fm.version+"<br/>jQuery/jQueryUI: "+a().jquery+"/"+a.ui.version+'<br clear="all"/><p><strong><a href="http://elrte.org/'+this.fm.options.lang+'/elfinder" target="_blank">'+this.fm.i18n("Donate to support project development")+'</a></strong></p><p><a href="http://elrte.org/redmine/projects/elfinder/wiki" target="_blank">'+this.fm.i18n("elFinder documentation")+"</a></p>",b+="<p>"+(c!="helpText"?c:"elFinder works similar to file manager on your computer. <br /> To make actions on files/folders use icons on top panel. If icon action it is not clear for you, hold mouse cursor over it to see the hint. <br /> Manipulations with existing files/folders can be done through the context menu (mouse right-click).<br/> To copy/delete a group of files/folders, select them using Shift/Alt(Command) + mouse left-click.")+"</p>",b+="<p><strong>"+this.fm.i18n("elFinder support following shortcuts")+":</strong><ul><li><kbd>Ctrl+A</kbd> - "+this.fm.i18n("Select all files")+"</li><li><kbd>Ctrl+C/Ctrl+X/Ctrl+V</kbd> - "+this.fm.i18n("Copy/Cut/Paste files")+"</li><li><kbd>Enter</kbd> - "+this.fm.i18n("Open selected file/folder")+"</li><li><kbd>Space</kbd> - "+this.fm.i18n("Open/close QuickLook window")+"</li><li><kbd>Delete/Cmd+Backspace</kbd> - "+this.fm.i18n("Remove selected files")+"</li><li><kbd>Ctrl+I</kbd> - "+this.fm.i18n("Selected files or current directory info")+"</li><li><kbd>Ctrl+N</kbd> - "+this.fm.i18n("Create new directory")+"</li><li><kbd>Ctrl+U</kbd> - "+this.fm.i18n("Open upload files form")+"</li><li><kbd>Left arrow</kbd> - "+this.fm.i18n("Select previous file")+"</li><li><kbd>Right arrow </kbd> - "+this.fm.i18n("Select next file")+"</li><li><kbd>Ctrl+Right arrow</kbd> - "+this.fm.i18n("Open selected file/folder")+"</li><li><kbd>Ctrl+Left arrow</kbd> - "+this.fm.i18n("Return into previous folder")+"</li><li><kbd>Shift+arrows</kbd> - "+this.fm.i18n("Increase/decrease files selection")+"</li></ul></p><p>"+this.fm.i18n("Contacts us if you need help integrating elFinder in you products")+": dev@std42.ru</p>",d='<div class="el-finder-help-std"/><p>'+this.fm.i18n("Javascripts/PHP programming: Dmitry (dio) Levashov, dio@std42.ru")+"</p><p>"+this.fm.i18n("Python programming, techsupport: Troex Nevelin, troex@fury.scancode.ru")+"</p><p>"+this.fm.i18n("Design: Valentin Razumnih")+"</p><p>"+this.fm.i18n("Chezh localization")+": Roman Matěna, info@romanmatena.cz</p><p>"+this.fm.i18n("Chinese (traditional) localization")+": Tad, tad0616@gmail.com</p><p>"+this.fm.i18n("Dutch localization")+': Kurt Aerts, <a href="http://ilabsolutions.net/" target="_blank">http://ilabsolutions.net</a></p><p>'+this.fm.i18n("Greek localization")+": Panagiotis Skarvelis</p><p>"+this.fm.i18n("Hungarian localization")+": Viktor Tamas, tamas.viktor@totalstudio.hu</p><p>"+this.fm.i18n("Italian localization")+":  Ugo Punzolo, sadraczerouno@gmail.com</p><p>"+this.fm.i18n("Latvian localization")+":  Uldis Plotiņš, uldis.plotins@gmail.com</p><p>"+this.fm.i18n("Poland localization")+":  Darek Wapiński, darek@wapinski.us</p><p>"+this.fm.i18n("Spanish localization")+': Alex (xand) Vavilin, xand@xand.es, <a href="http://xand.es" target="_blank">http://xand.es</a></p><p>'+this.fm.i18n("Icons")+': <a href="http://pixelmixer.ru/" target="_blank">pixelmixer</a>,  <a href="http://www.famfamfam.com/lab/icons/silk/" target="_blank">Famfam silk icons</a>, <a href="http://www.fatcow.com/free-icons/" target="_blank">Fatcow icons</a></p><p>'+this.fm.i18n('Copyright: <a href="http://www.std42.ru" target="_blank">Studio 42 LTD</a>')+"</p><p>"+this.fm.i18n("License: BSD License")+"</p><p>"+this.fm.i18n('Web site: <a href="http://elrte.org/elfinder/" target="_blank">elrte.org/elfinder</a>')+"</p>",e='<div class="el-finder-logo"/><strong><a href="http://www.eldorado-cms.ru" target="_blank">ELDORADO.CMS</a></strong><br/>'+this.fm.i18n("Simple and usefull Content Management System")+"<hr/>"+this.fm.i18n("Support project development and we will place here info about you"),f='<ul><li><a href="#el-finder-help-h">'+this.fm.i18n("Help")+'</a></li><li><a href="#el-finder-help-a">'+this.fm.i18n("Authors")+'</a><li><a href="#el-finder-help-sp">'+this.fm.i18n("Sponsors")+'</a></li></ul><div id="el-finder-help-h"><p>'+b+'</p></div><div id="el-finder-help-a"><p>'+d+'</p></div><div id="el-finder-help-sp"><p>'+e+"</p></div>";var g=a("<div/>").html(f).dialog({width:617,title:this.fm.i18n("Help"),dialogClass:"el-finder-dialog",modal:!0,close:function(){g.tabs("destroy").dialog("destroy").remove()},buttons:{Ok:function(){a(this).dialog("close")}}}).tabs()},this.cm=function(a){return a=="cwd"}}}}(jQuery),function(a){elFinder.prototype.quickLook=function(b,c){function j(){d.media.hide().empty(),d.win.attr("class","el-finder-ql").css("z-index",d.fm.zIndex),d.title.empty(),d.ico.attr("style","").show(),d.add.hide().empty(),d._hash=""}function k(){var a=d.fm.getSelected(0);j(),d._hash=a.hash,d.title.text(a.name),d.win.addClass(d.fm.view.mime2class(a.mime)),d.name.text(a.name),d.kind.text(d.fm.view.mime2kind(a.link?"symlink":a.mime)),d.size.text(d.fm.view.formatSize(a.size)),d.date.text(d.fm.i18n("Modified")+": "+d.fm.view.formatDate(a.date)),a.dim&&d.add.append("<span>"+a.dim+" px</span>").show(),a.tmb&&d.ico.css("background",'url("'+a.tmb+'") 0 0 no-repeat');if(a.url){d.url.text(a.url).attr("href",a.url).show();for(var b in d.plugins)if(d.plugins[b].test&&d.plugins[b].test(a.mime,d.mimes,a.name)){d.plugins[b].show(d,a);return}}else d.url.hide();d.win.css({width:"420px",height:"auto"})}var d=this;this.fm=b,this._hash="",this.title=a("<strong/>"),this.ico=a("<p/>"),this.info=a("<label/>"),this.media=a('<div class="el-finder-ql-media"/>').hide(),this.name=a('<span class="el-finder-ql-name"/>'),this.kind=a('<span class="el-finder-ql-kind"/>'),this.size=a('<span class="el-finder-ql-size"/>'),this.date=a('<span class="el-finder-ql-date"/>'),this.url=a('<a href="#"/>').hide().click(function(b){b.preventDefault(),window.open(a(this).attr("href")),d.hide()}),this.add=a("<div/>"),this.content=a('<div class="el-finder-ql-content"/>'),this.win=a('<div class="el-finder-ql"/>').hide().append(a('<div class="el-finder-ql-drag-handle"/>').append(a('<span class="ui-icon ui-icon-circle-close"/>').click(function(){d.hide()})).append(this.title)).append(this.ico).append(this.media).append(this.content.append(this.name).append(this.kind).append(this.size).append(this.date).append(this.url).append(this.add)).appendTo("body").draggable({handle:".el-finder-ql-drag-handle"}).resizable({minWidth:420,minHeight:150,resize:function(){if(d.media.children().length){var a=d.media.children(":first");switch(a[0].nodeName){case"IMG":var b=a.width(),c=a.height(),e=d.win.width(),f=d.win.css("height")=="auto"?350:d.win.height()-d.content.height()-d.th,g=b>e||c>f?Math.min(Math.min(e,b)/b,Math.min(f,c)/c):Math.min(Math.max(e,b)/b,Math.max(f,c)/c);a.css({width:Math.round(a.width()*g),height:Math.round(a.height()*g)});break;case"IFRAME":case"EMBED":a.css("height",d.win.height()-d.content.height()-d.th);break;case"OBJECT":a.children("embed").css("height",d.win.height()-d.content.height()-d.th)}}}}),this.th=parseInt(this.win.children(":first").css("height"))||18,this.mimes={"image/jpeg":"jpg","image/gif":"gif","image/png":"png"};for(var e=0;e<navigator.mimeTypes.length;e++){var f=navigator.mimeTypes[e].type;f&&f!="*"&&(this.mimes[f]=navigator.mimeTypes[e].suffixes)}if(a.browser.safari&&navigator.platform.indexOf("Mac")!=-1||a.browser.msie)this.mimes["application/pdf"]="pdf";else for(var g=0;g<navigator.plugins.length;g++)for(var h=0;h<navigator.plugins[g].length;h++){var i=navigator.plugins[g][h].description.toLowerCase();if(i.substring(0,i.indexOf(" "))=="pdf"){this.mimes["application/pdf"]="pdf";break}}this.mimes["image/x-bmp"]&&(this.mimes["image/x-ms-bmp"]="bmp"),a.browser.msie&&!this.mimes["application/x-shockwave-flash"]&&(this.mimes["application/x-shockwave-flash"]="swf"),this.show=function(){if(this.win.is(":hidden")&&d.fm.selected.length==1){k();var b=d.fm.selected[0],c=d.fm.view.cwd.find('[key="'+b+'"]'),e=c.offset();d.fm.lockShortcuts(!0),this.win.css({width:c.width()-20,height:c.height(),left:e.left,top:e.top,opacity:0}).show().animate({width:420,height:150,opacity:1,top:Math.round(a(window).height()/5),left:a(window).width()/2-210},450,function(){d.win.css({height:"auto"}),d.fm.lockShortcuts()})}},this.hide=function(){if(this.win.is(":visible")){var a,b=d.fm.view.cwd.find('[key="'+this._hash+'"]');b?(a=b.offset(),this.media.hide(200),this.win.animate({width:b.width()-20,height:b.height(),left:a.left,top:a.top,opacity:0},350,function(){d.fm.lockShortcuts(),j(),d.win.hide().css("height","auto")})):(this.win.fadeOut(200),j(),d.fm.lockShortcuts())}},this.toggle=function(){this.win.is(":visible")?this.hide():this.show()},this.update=function(){this.fm.selected.length!=1?this.hide():this.win.is(":visible")&&this.fm.selected[0]!=this._hash&&k()},this.mediaHeight=function(){return this.win.is(":animated")||this.win.css("height")=="auto"?315:this.win.height()-this.content.height()-this.th}},elFinder.prototype.quickLook.prototype.plugins={image:new function(){this.test=function(a,b){return a.match(/^image\//)},this.show=function(b,c){function f(a){var c=a.width(),d=a.height(),e=b.win.is(":animated"),f=e?420:b.win.width(),g=e||b.win.css("height")=="auto"?315:b.win.height()-b.content.height()-b.th,h=c>f||d>g?Math.min(Math.min(f,c)/c,Math.min(g,d)/d):Math.min(Math.max(f,c)/c,Math.max(g,d)/d);b.fm.lockShortcuts(!0),b.ico.hide(),a.css({width:b.ico.width(),height:b.ico.height()}).show().animate({width:Math.round(h*c),height:Math.round(h*d)},450,function(){b.fm.lockShortcuts()})}var d,e;b.mimes[c.mime]&&c.hash==b._hash&&a("<img/>").hide().appendTo(b.media.show()).attr("src",c.url+(a.browser.msie||a.browser.opera?"?"+Math.random():"")).load(function(){e=a(this).unbind("load"),c.hash==b._hash&&(b.win.is(":animated")?setTimeout(function(){f(e)},330):f(e))})}},text:new function(){this.test=function(a,b){return a.indexOf("text")==0&&a.indexOf("rtf")==-1||a.match(/application\/(xml|javascript|json)/)},this.show=function(a,b){b.hash==a._hash&&(a.ico.hide(),a.media.append('<iframe src="'+b.url+'" style="height:'+a.mediaHeight()+'px" />').show())}},swf:new function(){this.test=function(a,b){return a=="application/x-shockwave-flash"&&b[a]},this.show=function(a,b){if(b.hash==a._hash){a.ico.hide();var c=a.media.append('<embed pluginspage="http://www.macromedia.com/go/getflashplayer" quality="high" src="'+b.url+'" style="width:100%;height:'+a.mediaHeight()+'px" type="application/x-shockwave-flash" />');a.win.is(":animated")?c.slideDown(450):c.show()}}},audio:new function(){this.test=function(a,b){return a.indexOf("audio")==0&&b[a]},this.show=function(a,b){if(b.hash==a._hash){a.ico.hide();var c=a.win.is(":animated")||a.win.css("height")=="auto"?100:a.win.height()-a.content.height()-a.th;a.media.append('<embed src="'+b.url+'" style="width:100%;height:'+c+'px" />').show()}}},video:new function(){this.test=function(a,b){return a.indexOf("video")==0&&b[a]},this.show=function(a,b){b.hash==a._hash&&(a.ico.hide(),a.media.append('<embed src="'+b.url+'" style="width:100%;height:'+a.mediaHeight()+'px" />').show())}},pdf:new function(){this.test=function(a,b){return a=="application/pdf"&&b[a]},this.show=function(a,b){b.hash==a._hash&&(a.ico.hide(),a.media.append('<embed src="'+b.url+'" style="width:100%;height:'+a.mediaHeight()+'px" />').show())}}}}(jQuery),function(a){elFinder.prototype.eventsManager=function(b,c){function e(b,c){var e,f,g;if(!a("[key]",d.cwd).length)return;if(d.fm.selected.length==0)e=a("[key]:"+(b?"first":"last"),d.cwd),d.fm.select(e);else if(c)e=a(".ui-selected:"+(b?"last":"first"),d.cwd),f=e[b?"next":"prev"]("[key]"),f.length&&(e=f),d.fm.select(e,!0);else{d.pointer&&(g=a('[key="'+d.pointer+'"].ui-selected',d.cwd));if(!g||!g.length)g=a(".ui-selected:"+(b?"last":"first"),d.cwd);e=g[b?"next":"prev"]("[key]");if(!e.length)e=g;else if(!e.hasClass("ui-selected"))d.fm.select(e);else if(!g.hasClass("ui-selected"))d.fm.unselect(e);else{f=g[b?"prev":"next"]("[key]");if(!f.length||!f.hasClass("ui-selected"))d.fm.unselect(g);else{while((f=b?e.next("[key]"):e.prev("[key]"))&&e.hasClass("ui-selected"))e=f;d.fm.select(e)}}}d.pointer=e.attr("key"),d.fm.checkSelectedPos(b)}var d=this;this.lock=!1,this.fm=b,this.ui=b.ui,this.tree=b.view.tree,this.cwd=b.view.cwd,this.pointer="",this.init=function(){var b=this,c=!1;b.lock=!1,this.cwd.bind("click",function(c){var d=a(c.target);d.hasClass("ui-selected")?b.fm.unselectAll():(d.attr("key")||(d=d.parent("[key]")),c.ctrlKey||c.metaKey?b.fm.toggleSelect(d):b.fm.select(d,!0))}).bind(window.opera?"click":"contextmenu",function(d){if(window.opera&&!d.ctrlKey)return;d.preventDefault(),d.stopPropagation();var e=a(d.target);a.browser.mozilla&&(c=!0),e.hasClass("el-finder-cwd")?b.fm.unselectAll():b.fm.select(e.attr("key")?e:e.parent("[key]")),b.fm.quickLook.hide(),b.fm.ui.showMenu(d)}).selectable({filter:"[key]",delay:300,stop:function(){b.fm.updateSelect(),b.fm.log("mouseup")}}),a(document).bind("click",function(d){!c&&b.fm.ui.hideMenu(),c=!1,a("input",b.cwd).trigger("change"),a(d.target).is("input,textarea,select")||a("input,textarea").blur()}),a("input,textarea").live("focus",function(a){b.lock=!0}).live("blur",function(a){b.lock=!1}),this.tree.bind("select",function(c){b.tree.find("a").removeClass("selected"),a(c.target).addClass("selected").parents("li:has(ul)").children("ul").show().prev().children("div").addClass("expanded")}),this.fm.options.places&&(this.fm.view.plc.click(function(c){c.preventDefault();var d=a(c.target),e=d.attr("key"),f;if(e)e!=b.fm.cwd.hash&&b.ui.exec("open",c.target);else if(c.target.nodeName=="A"||c.target.nodeName=="DIV")f=b.fm.view.plc.find("ul"),f.children().length&&(f.toggle(300),b.fm.view.plc.children("li").find("div").toggleClass("expanded"))}),this.fm.view.plc.droppable({accept:"(div,tr).directory",tolerance:"pointer",over:function(){a(this).addClass("el-finder-droppable")},out:function(){a(this).removeClass("el-finder-droppable")},drop:function(c,d){a(this).removeClass("el-finder-droppable");var e=!1;d.helper.children(".directory:not(.noaccess,.dropbox)").each(function(){b.fm.addPlace(a(this).attr("key"))&&(e=!0,a(this).hide())}),e&&(b.fm.view.renderPlaces(),b.updatePlaces(),b.fm.view.plc.children("li").children("div").trigger("click")),d.helper.children("div:visible").length||d.helper.hide()}})),a(document).bind(a.browser.mozilla||a.browser.opera?"keypress":"keydown",function(a){var c=a.ctrlKey||a.metaKey;if(b.lock)return;switch(a.keyCode){case 37:case 38:a.stopPropagation(),a.preventDefault(),a.keyCode==37&&c?b.ui.execIfAllowed("back"):e(!1,!a.shiftKey);break;case 39:case 40:a.stopPropagation(),a.preventDefault(),c?b.ui.execIfAllowed("open"):e(!0,!a.shiftKey)}}),a(document).bind(a.browser.opera?"keypress":"keydown",function(a){if(b.lock)return;switch(a.keyCode){case 32:a.preventDefault(),a.stopPropagation(),b.fm.quickLook.toggle();break;case 27:b.fm.quickLook.hide()}}),this.fm.options.disableShortcuts||a(document).bind("keydown",function(a){var c=a.ctrlKey||a.metaKey;if(b.lock)return;switch(a.keyCode){case 8:c&&b.ui.isCmdAllowed("rm")&&(a.preventDefault(),b.ui.exec("rm"));break;case 13:if(b.ui.isCmdAllowed("select"))return b.ui.exec("select");b.ui.execIfAllowed("open");break;case 46:b.ui.execIfAllowed("rm");break;case 65:c&&(a.preventDefault(),b.fm.selectAll());break;case 67:c&&b.ui.execIfAllowed("copy");break;case 73:c&&(a.preventDefault(),b.ui.exec("info"));break;case 78:c&&(a.preventDefault(),b.ui.execIfAllowed("mkdir"));break;case 85:c&&(a.preventDefault(),b.ui.execIfAllowed("upload"));break;case 86:c&&b.ui.execIfAllowed("paste");break;case 88:c&&b.ui.execIfAllowed("cut");break;case 113:b.ui.execIfAllowed("rename")}})},this.updateNav=function(){a("a",this.tree).click(function(b){b.preventDefault();var c=a(this),e;b.target.nodeName=="DIV"&&a(b.target).hasClass("collapsed")?a(b.target).toggleClass("expanded").parent().next("ul").toggle(300):c.attr("key")!=d.fm.cwd.hash?c.hasClass("noaccess")||c.hasClass("dropbox")?d.fm.view.error("Access denied"):d.ui.exec("open",c.trigger("select")[0]):(e=c.children(".collapsed"),e.length&&(e.toggleClass("expanded"),c.next("ul").toggle(300)))}),a("a:not(.noaccess,.readonly)",this.tree).droppable({tolerance:"pointer",accept:"div[key],tr[key]",over:function(){a(this).addClass("el-finder-droppable")},out:function(){a(this).removeClass("el-finder-droppable")},drop:function(b,c){a(this).removeClass("el-finder-droppable"),d.fm.drop(b,c,a(this).attr("key"))}}),this.fm.options.places&&this.updatePlaces()},this.updatePlaces=function(){this.fm.view.plc.children("li").find("li").draggable({scroll:!1,stop:function(){d.fm.removePlace(a(this).children("a").attr("key"))&&(a(this).remove(),a("li",d.fm.view.plc.children("li")).length||d.fm.view.plc.children("li").find("div").removeClass("collapsed expanded").end().children("ul").hide())}})},this.updateCwd=function(){a("[key]",this.cwd).bind("dblclick",function(b){d.fm.select(a(this),!0),d.ui.exec(d.ui.isCmdAllowed("select")?"select":"open")}).draggable({delay:3,addClasses:!1,appendTo:".el-finder-cwd",revert:!0,drag:function(a,b){b.helper.toggleClass("el-finder-drag-copy",a.shiftKey||a.ctrlKey)},helper:function(){var b=a(this),c=a('<div class="el-finder-drag-helper"/>'),e=0;return!b.hasClass("ui-selected")&&d.fm.select(b,!0),d.cwd.find(".ui-selected").each(function(b){var f=d.fm.options.view=="icons"?a(this).clone().removeClass("ui-selected"):a(d.fm.view.renderIcon(d.fm.cdc[a(this).attr("key")]));(e++==0||e%12==0)&&f.css("margin-left",0),c.append(f)}),c.css("width",(e<=12?85+(e-1)*29:387)+"px")}}).filter(".directory").droppable({tolerance:"pointer",accept:"div[key],tr[key]",over:function(){a(this).addClass("el-finder-droppable")},out:function(){a(this).removeClass("el-finder-droppable")},drop:function(b,c){a(this).removeClass("el-finder-droppable"),d.fm.drop(b,c,a(this).attr("key"))}}),a.browser.msie&&a("*",this.cwd).attr("unselectable","on").filter("[key]").bind("dragstart",function(){d.cwd.selectable("disable").removeClass("ui-state-disabled ui-selectable-disabled")}).bind("dragstop",function(){d.cwd.selectable("enable")})}}}(jQuery)